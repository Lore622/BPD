data = df_mod
)
summary(m_RR)
# VT/kg
m_VTkg <- glmmTMB(
Tidal_volume ~ Time_c + BPD * hsPDA_c + GA_c + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
# tPTEF
m_tPTEF <- glmmTMB(
Time_PTEF ~ Time_c + BPD * hsPDA_c + GA_c + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
# RR
m_RR <- glmmTMB(
RR ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
# VT/kg
m_VTkg <- glmmTMB(
Tidal_volume ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
# tPTEF
m_tPTEF <- glmmTMB(
Time_PTEF ~ Time_c + BPD * hsPDA_c + GA_c + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
# tPTEF
m_tPTEF <- glmmTMB(
Time_PTEF ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_tPTEF)
library(dplyr)
library(glmmTMB)
df_sens <- df_mod %>%
mutate(
BPD_sev = case_when(
BPD_Jensen == 0 ~ "noBPD",
BPD_Jensen == 1 & Grado123 == 1 ~ "mild",
BPD_Jensen == 1 & Grado123 == 2 ~ "moderate",
BPD_Jensen == 1 & Grado123 == 3 ~ "severe",
TRUE ~ NA_character_
),
BPD_sev = factor(BPD_sev, levels = c("noBPD", "mild", "moderate", "severe"))
) %>%
filter(!is.na(BPD_sev))
library(dplyr)
library(ggplot2)
# Frequenze della severità SOLO tra i BPD (Grado123 = 1/2/3)
freq_sev <- df_mod %>%
filter(BPD_Jensen == 1, !is.na(Grado123)) %>%
mutate(Grado123 = factor(Grado123, levels = c(1,2,3),
labels = c("mild (1)", "moderate (2)", "severe (3)"))) %>%
count(Grado123, name = "n")
freq_sev
ggplot(freq_sev, aes(x = Grado123, y = n)) +
geom_col() +
geom_text(aes(label = n), vjust = -0.4) +
labs(x = "BPD severity (Jensen grade)", y = "Number of observations",
title = "Distribuzione della severità BPD (solo soggetti con BPD)") +
theme_classic(base_size = 14)
m_sev <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * hsPDA + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_sev)
# 4. Categorico PDA: 0 / 1–7 / >7 per robustezza,
df_sens %>%
distinct(ID, hsPDA_cat) %>%
count(hsPDA_cat) %>%
ggplot(aes(x = hsPDA_cat, y = n)) +
geom_col(fill = "grey80", color = "black") +
theme_classic() +
labs(x = "hsPDA category", y = "Number of subjects (unique ID)")
df_sens <- df_sens %>%
mutate(
hsPDA_cat = cut(HSPDAgg,
breaks = c(-Inf, 0, 7, Inf),
labels = c("0", "1-7", ">7")),
hsPDA_cat = relevel(hsPDA_cat, ref = "0")
)
m_pda_cat <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * hsPDA_cat + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_pda_cat)
df_sens <- df_sens %>%
mutate(
pda_0_7 = pmin(HSPDAgg, 7),
pda_gt7 = pmax(HSPDAgg - 7, 0),
)
m_piece <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * (pda_0_7 + pda_gt7) + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_piece)
AIC(m_level0, m_sev, m_pda_cat, m_piece)
# Cartella target (Windows-friendly)
models_dir <- "C:/Users/39348/Desktop/BPD/data/derived/models"
dir.create(models_dir, recursive = TRUE, showWarnings = FALSE)
models <- list(
m_level0  = m_level0,
m_traj    = m_traj,
m_sens_BW = m_sens_BW,
m_RR      = m_RR,
m_VTkg    = m_VTkg,
m_tPTEF   = m_tPTEF,
m_sev     = m_sev,
m_pda_cat = m_pda_cat,
m_piece   = m_piece
)
saveRDS(models, file = file.path(models_dir, "all_models.rds"))
# Cartella target (Windows-friendly)
models_dir <- "C:/Users/39348/Desktop/BPD/data/derived/models"
dir.create(models_dir, recursive = TRUE, showWarnings = FALSE)
models <- list(
m_level0  = m_level0,
m_traj    = m_traj,
m_sens_BW = m_sens_BW,
m_RR      = m_RR,
m_VTkg    = m_VTkg,
m_tPTEF   = m_tPTEF,
m_sev     = m_sev,
m_pda_cat = m_pda_cat,
m_piece   = m_piece
)
m_sens_BW <- glmmTMB(
tPTEF_perc_tE ~ Time_c + BPD * hsPDA_c + BW + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
m_sens_BW <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD * hsPDA + BW + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
m_sens_BW <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD * hsPDA + PN + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
# RR
m_RR <- glmmTMB(
RR ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
# VT/kg
m_VTkg <- glmmTMB(
Tidal_volume ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
# tPTEF
m_tPTEF <- glmmTMB(
Time_PTEF ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_tPTEF)
library(dplyr)
library(glmmTMB)
df_sens <- df_mod %>%
mutate(
BPD_sev = case_when(
BPD_Jensen == 0 ~ "noBPD",
BPD_Jensen == 1 & Grado123 == 1 ~ "mild",
BPD_Jensen == 1 & Grado123 == 2 ~ "moderate",
BPD_Jensen == 1 & Grado123 == 3 ~ "severe",
TRUE ~ NA_character_
),
BPD_sev = factor(BPD_sev, levels = c("noBPD", "mild", "moderate", "severe"))
) %>%
filter(!is.na(BPD_sev))
library(dplyr)
library(ggplot2)
# Frequenze della severità SOLO tra i BPD (Grado123 = 1/2/3)
freq_sev <- df_mod %>%
filter(BPD_Jensen == 1, !is.na(Grado123)) %>%
mutate(Grado123 = factor(Grado123, levels = c(1,2,3),
labels = c("mild (1)", "moderate (2)", "severe (3)"))) %>%
count(Grado123, name = "n")
freq_sev
ggplot(freq_sev, aes(x = Grado123, y = n)) +
geom_col() +
geom_text(aes(label = n), vjust = -0.4) +
labs(x = "BPD severity (Jensen grade)", y = "Number of observations",
title = "Distribuzione della severità BPD (solo soggetti con BPD)") +
theme_classic(base_size = 14)
m_sev <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * hsPDA + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_sev)
# 4. Categorico PDA: 0 / 1–7 / >7 per robustezza,
df_sens %>%
distinct(ID, hsPDA_cat) %>%
count(hsPDA_cat) %>%
ggplot(aes(x = hsPDA_cat, y = n)) +
geom_col(fill = "grey80", color = "black") +
theme_classic() +
labs(x = "hsPDA category", y = "Number of subjects (unique ID)")
df_sens <- df_sens %>%
mutate(
hsPDA_cat = cut(HSPDAgg,
breaks = c(-Inf, 0, 7, Inf),
labels = c("0", "1-7", ">7")),
hsPDA_cat = relevel(hsPDA_cat, ref = "0")
)
m_pda_cat <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * hsPDA_cat + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_pda_cat)
df_sens <- df_sens %>%
mutate(
pda_0_7 = pmin(HSPDAgg, 7),
pda_gt7 = pmax(HSPDAgg - 7, 0),
)
m_piece <- glmmTMB(
tPTEF_perc_tE ~ Time + BPD_sev * (pda_0_7 + pda_gt7) + GA + sex + LOS + PH + (1|ID),
family = Gamma(link="log"),
data = df_sens
)
summary(m_piece)
AIC(m_level0, m_sev, m_pda_cat, m_piece)
# Cartella target (Windows-friendly)
models_dir <- "C:/Users/39348/Desktop/BPD/data/derived/models"
dir.create(models_dir, recursive = TRUE, showWarnings = FALSE)
models <- list(
m_level0  = m_level0,
m_traj    = m_traj,
m_sens_BW = m_sens_BW,
m_RR      = m_RR,
m_VTkg    = m_VTkg,
m_tPTEF   = m_tPTEF,
m_sev     = m_sev,
m_pda_cat = m_pda_cat,
m_piece   = m_piece
)
saveRDS(models, file = file.path(models_dir, "all_models.rds"))
exp(-0.003242)
1- 0.9967632
0.0032368*100
exp(-0.121165 )
1-0.8858878
exp(-0.007881)
1-0.99215
exp(0.008528)
1-1.008564
-0.008564*100
exp( 0.044650)
1.04-1
0.04*100
exp(0.152102)
exp(-0.222199)
# RR
m_RR <- glmmTMB(
RR ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_RR)
check_model(m_RR)
df_mod$RR
summary(df_mod$RR)
p_hist_dens_RR <- ggplot(df_use, aes(x = RR)) +
geom_histogram(
aes(y = after_stat(density)),
bins = 25,
fill = "grey85",
color = "black",
linewidth = 0.35
) +
geom_density(
color = "red3",   # se la vuoi rossa
linewidth = 1,
trim = TRUE,
cut = 0
) +
coord_cartesian(xlim = c(x_min, x_max)) +
labs(
title = "Distribution of RR",
x = "RR",
y = "Density"
) +
theme_classic(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black")
)
p_hist_dens_RR <- ggplot(df_mod, aes(x = RR)) +
geom_histogram(
aes(y = after_stat(density)),
bins = 25,
fill = "grey85",
color = "black",
linewidth = 0.35
) +
geom_density(
color = "red3",   # se la vuoi rossa
linewidth = 1,
trim = TRUE,
cut = 0
) +
coord_cartesian(xlim = c(x_min, x_max)) +
labs(
title = "Distribution of RR",
x = "RR",
y = "Density"
) +
theme_classic(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black")
)
p_hist_dens_RR
summary(df_mod$RR)
shapiro.test(df_mod$RR)
# VT/kg
m_VTkg <- glmmTMB(
Tidal_volume ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_VTkg)
summary(df_mod$m_VTKg)
summary(df_mod$Tidal_volume)
performance::check_model(m_VTKg)
# VT/kg
m_VTkg <- glmmTMB(
Tidal_volume ~ Time + BPD * hsPDA + GA + sex + LOS + PH + (1 | ID),
family = Gamma(link = "log"),
data = df_mod
)
summary(m_VTkg)
performance::check_model(m_VTKg)
performance::check_model(m_VTkg)
summary(df_mod$Tidal_volume)
summary(df_mod$m_tPTEF)
summary(df_mod$Time_PTEF)
plot(df_mod$Time_PTEF)
plot(df_mod$Time_PTEF,hline="red")
?plot
plot((df_mod$Tidal_volume))
p_hist_dens_Volume <- ggplot(df_mod, aes(x = Tidal_volume)) +
geom_histogram(
aes(y = after_stat(density)),
bins = 25,
fill = "grey85",
color = "black",
linewidth = 0.35
) +
geom_density(
color = "red3",   # se la vuoi rossa
linewidth = 1,
trim = TRUE,
cut = 0
) +
coord_cartesian(xlim = c(x_min, x_max)) +
labs(
title = "Distribution of RR",
x = "RR",
y = "Density"
) +
theme_classic(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black")
)
p_hist_dens_Volume <- ggplot(df_mod, aes(x = Tidal_volume)) +
geom_histogram(
aes(y = after_stat(density)),
bins = 25,
fill = "grey85",
color = "black",
linewidth = 0.35
) +
geom_density(
color = "red3",   # se la vuoi rossa
linewidth = 1,
trim = TRUE
) +
coord_cartesian(xlim = c(x_min, x_max)) +
labs(
title = "Distribution of RR",
x = "RR",
y = "Density"
) +
theme_classic(base_size = 14) +
theme(
plot.title = element_text(face = "bold"),
axis.line = element_line(color = "black"),
axis.ticks = element_line(color = "black")
)
p_hist_dens_Volume
length(unique(df_mod$ID))
length(unique(df_mod$Grado123))
unique(df_mod$Grado123))
unique(df_mod$Grado123)
head(df_mod)
View(df_mod)
table(df_mod$ID,df_mod$Grado123)
ifelse(is.na(df_mod$Grado123,0,Grado123))
df_mod$Grado123<-felse(is.na(df_mod$Grado123),0,df_mod$Grado123)
df_mod$Grado123<-ifelse(is.na(df_mod$Grado123),0,df_mod$Grado123)
uniqe(df_mod$Grado123)
unique(df_mod$Grado123)
View(df_mod)
library(dplyr)
library(glmmTMB)
df_sens <- df_mod %>%
mutate(
BPD_sev = case_when(
Grado123 == 0 ~ "noBPD",
BPD_Jensen == 1 & Grado123 == 1 ~ "mild",
BPD_Jensen == 1 & Grado123 == 2 ~ "moderate",
BPD_Jensen == 1 & Grado123 == 3 ~ "severe",
TRUE ~ NA_character_
),
BPD_sev = factor(BPD_sev, levels = c("noBPD", "mild", "moderate", "severe"))
) %>%
filter(!is.na(BPD_sev))
library(dplyr)
library(ggplot2)
# Frequenze della severità SOLO tra i BPD (Grado123 = 1/2/3)
freq_sev <- df_mod %>%
filter(BPD_Jensen == 1, !is.na(Grado123)) %>%
mutate(Grado123 = factor(Grado123, levels = c(1,2,3),
labels = c("mild (1)", "moderate (2)", "severe (3)"))) %>%
count(Grado123, name = "n")
freq_sev
ggplot(freq_sev, aes(x = Grado123, y = n)) +
geom_col() +
geom_text(aes(label = n), vjust = -0.4) +
labs(x = "BPD severity (Jensen grade)", y = "Number of observations",
title = "Distribuzione della severità BPD (solo soggetti con BPD)") +
theme_classic(base_size = 14)
df_sens <- df_mod %>%
mutate(
BPD_sev = case_when(
Grado123 == 0 ~ "noBPD",
BPD_Jensen == 1 & Grado123 == 1 ~ "mild",
BPD_Jensen == 1 & Grado123 == 2 ~ "moderate",
BPD_Jensen == 1 & Grado123 == 3 ~ "severe",
TRUE ~ NA_character_
),
BPD_sev = factor(BPD_sev, levels = c("noBPD", "mild", "moderate", "severe"))
) %>%
filter(!is.na(BPD_sev))
nrow(BPD_sev)
nrow(df_mod$Grado123)
length(df_mod$Grado123)
df_sens <- df_mod %>%
mutate(
BPD_sev = case_when(
Grado123 == 0 ~ "noBPD",
BPD_Jensen == 1 & Grado123 == 1 ~ "mild",
BPD_Jensen == 1 & Grado123 == 2 ~ "moderate",
BPD_Jensen == 1 & Grado123 == 3 ~ "severe",
TRUE ~ NA_character_
),
BPD_sev = factor(BPD_sev, levels = c("noBPD", "mild", "moderate", "severe"))
) %>%
filter(!is.na(BPD_sev))
View(df_sens)
aggregate(df_sens$ID,df_sens$BPD_sev)
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=count)
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=sum)
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=length)
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique)
)
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique))
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique()))
aggregate(x=df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique(x)))
aggregate(x=df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique(x)))
aggregate(df_sens$BPD_sev ~ df_sens$ID, FUN=length(unique()))
freq_sev <- df_mod %>%
filter(BPD_Jensen == 1, !is.na(Grado123)) %>%
distinct(ID, Grado123) %>%   # <-- una riga per ID (con la sua severità)
mutate(Grado123 = factor(
Grado123, levels = c(1,2,3),
labels = c("mild (1)", "moderate (2)", "severe (3)")
)) %>%
count(Grado123, name = "n_subj")
ggplot(freq_sev, aes(x = Grado123, y = n_subj)) +
geom_col() +
geom_text(aes(label = n_subj), vjust = -0.4) +
labs(x = "BPD severity (Jensen grade)", y = "Number of subjects (unique ID)",
title = "Distribuzione severità BPD (solo soggetti con BPD)") +
theme_classic(base_size = 14)
