{"title":"Analisi Statistiche BPD","markdown":{"yaml":{"title":"Analisi Statistiche BPD","author":"Lorenzo Atzeni","editor":"visual","format":{"html":{"self-contained":true,"number-sections":false}}},"headingText":"Data Cleaning","containsRefs":false,"markdown":"\n\n\n```{r,echo=F}\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(tibble)\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(glmmTMB) \nlibrary(here)\nlibrary(performance)\n\ndf_or<-read_excel(\"DATI/DATABASE Lorenzo.xlsx\")\n\ndf_raw <- read_excel(\"DATI/DF_Lore.xlsx\")\nmodels_dir <- \"C:/Users/39348/Desktop/BPD/data/derived/models\"\nmodels <- readRDS(file.path(models_dir, \"all_models.rds\"))\n\n\n\n\n```\n\nDurante l'ispezione del dataset originale, ho notato che alcuni soggetti presentavano lo stesso ID (\"TRAKCARE\"), probabilmente un codice predefinito del software utilizzato per la raccolta dati. Per garantire l'univocità degli identificativi, ho assegnato a questi soggetti un nuovo codice nel formato \"LA\" seguito da un numero progressivo.\n\nVerifichiamo che ora ogni soggetto abbia un ID univoco:\n\n```{r}\ncheck_ID<-df_raw %>% count(df_raw$ID)\nsummary(check_ID)\n```\n\nIl controllo conferma che tutti gli ID sono ora univoci (ogni soggetto compare una sola volta).\n\nI nomi delle colonne nel dataset originale contenevano parentesi e caratteri speciali (ad esempio spazi, simboli come `%`, `/`), che possono creare problemi nella manipolazione dei dati in R. Ho quindi rinominato le colonne rimuovendo questi caratteri.\n\nInoltre, il dataset si presenta in formato *wide* (una riga per soggetto, con colonne separate per ogni timepoint). Per l'analisi longitudinale è necessario convertirlo in formato *long* (una riga per ogni osservazione, con una colonna che identifica il timepoint).\n\n```{r,echo=F,results=\"hide\"}\nclass(df_raw$Time_1)\nclass(df_raw$Time_2)\ndf_raw$Time_2<-as.numeric(df_raw$Time_2)\n\ndf_long <- df_raw %>%\n  pivot_longer(\n    cols = matches(\"_(\\\\d+)$\"),   # tutte le colonne che finiscono con _numero\n    names_to = c(\".value\", \"timepoint\"),\n    names_pattern = \"^(.*)_(\\\\d+)$\"\n  ) %>%\n  mutate(timepoint = as.integer(timepoint))\n\n\n#check:\ngrep(\"tPTE\", names(df_long), value = TRUE)\n\n\n```\n\nControlliamo adesso il numero di osservazioni che abbiamo per ciascun timepoint.\n\n```{r}\ndf_long %>%\n  filter(!is.na(tPTEF_perc_tE)) %>%\n  distinct(ID, timepoint) %>%\n  count(timepoint)\n```\n\nVediamo che abbiamo 99 osservazioni dell'outocome di interesse **tPTEF_perc_tE** al primo timepoint; poi 64 al secondo e 32 al terzo.\n\nPer una visualizzazione più immediata:\n\n```{r,echo=F}\ndf_long %>%\n  filter(!is.na(tPTEF_perc_tE)) %>%\n  count(timepoint) %>%\n  ggplot(aes(x = factor(timepoint), y = n)) +\n  geom_col(fill = \"grey80\", color = \"black\") +\n  labs(x = \"Timepoint\", y = \"Number of observations  tPTEF%tE\") +\n  theme_classic(base_size = 14)\n```\n\nVediamo come si distribuisce l'outcome di interesse primario: tPTEF/Te % che nel nostro dataset è stato rinominato in tPTEF_perc_tE.\n\n```{r,echo=F}\ndf_use <- df_long %>% filter(!is.na(tPTEF_perc_tE))\n\nx_min <- min(df_use$tPTEF_perc_tE, na.rm = TRUE)\nx_max <- max(df_use$tPTEF_perc_tE, na.rm = TRUE)\n\n# -----------------------\n# 1) HISTOGRAM (count)\n# -----------------------\np_hist_dens <- ggplot(df_use, aes(x = tPTEF_perc_tE)) +\n  geom_histogram(\n    aes(y = after_stat(density)),\n    bins = 25,\n    fill = \"grey85\",\n    color = \"black\",\n    linewidth = 0.35\n  ) +\n  geom_density(\n    color = \"red3\",   # se la vuoi rossa\n    linewidth = 1,\n    trim = TRUE,\n    cut = 0\n  ) +\n  coord_cartesian(xlim = c(x_min, x_max)) +\n  labs(\n    title = \"Distribution of tPTEF%tE\",\n    x = \"tPTEF%tE\",\n    y = \"Density\"\n  ) +\n  theme_classic(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.line = element_line(color = \"black\"),\n    axis.ticks = element_line(color = \"black\")\n  )\n\np_hist_dens\n\n```\n\nDal grafico si vede che tPTEF%tE ha una distribuzione **asimmetrica positiva** (coda/skewed a destra). Questa forma è coerente con la scelta di fittare **un GLMM** (Generalized Linear Mixed Model) con family **Gamma** e **link log**, che gestisce bene variabili continue, positive e con asimmetria positiva.\n\n## Modello ad effetti misti GLMM\n\nStimiamo un *mixed model* per rispondere alla domanda di ricerca principale e fare valutazione della funzione respiratoria nei neonati con e senza broncodisplasia.\n\nDataset su cui stimeremo il modello:\n\n```{r}\ndf_mod <- df_long %>%\n  filter(!is.na(Time), !is.na(tPTEF_perc_tE),!is.na(PH)) %>%\n  mutate(\n    ID = factor(ID),\n    \n    BPD = factor(BPD_Jensen, levels = c(0,1)),#0=No;1=YES\n    sex = factor(sex1M2F, levels = c(1,2)),#1=M;2=F\n    \n    LOS = factor(LOS),\n    PH  = factor(PH),\n    GA=  as.numeric(EG),\n    hsPDA = as.numeric(HSPDAgg)\n    \n    )\n\n```\n\nIdealmente, il modello \"migliore\" avrebbe slope ed intercetta random (1 + Time \\| ID).\n\nNel termine `(1 + Time | ID)`:\n\n-   (**1 \\| ID)** = ogni soggetto ha una propria intercetta: consente livelli medi diversi di tPTEF%tE tra bambini.\n\n-   **(Time \\| ID)** = **quanto cambia nel tempo ogni partecipante**, cioè la sua “traiettoria”. E' ragionevole supporre che ogni neonato abbia una diversa pendenza.\n\n    Questa specifica è utile se i dati contengono informazione sufficiente per stimare variazione inter-individuale nelle traiettorie.\n\n```{r, eval=F}\nm_level <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD*HSPDAgg + GA + sex + LOS + PH +\n    (1 + Time | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n\n```\n\n```{r,echo=F}\nm_level <- models$m_level\nsummary(m_level)\n```\n\nFacendo la diagnostica della parte random si vede che la varianza della slope random di `Time` è praticamente nulla (≈ 0.000014) e la correlazione intercetta–slope è stimata a -1.00. Questo pattern indica che i dati **non supportano** una stima affidabile della slope random (modello “troppo complesso” rispetto all’informazione disponibile), e quindi la specifica più appropriata per l’analisi principale è il **random intercept** `(1 | ID)`.I l modello cheha una parte “random” troppo complessa rispetto all’informazione nei dati, quindi alcuni parametri dei random effects finiscono “sul bordo” (≈ 0) o diventano perfettamente collineari......\n\nRifittiamo quindi il modello con la sola intercetta random **(1 \\| ID).**\n\n```{r, eval=F}\nm_level0 <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD*hsPDA + GA + sex + LOS + PH +\n    (1 |  ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n\n```\n\nCome prima cosa andiamo a vedere i residui e gli assunti:\n\n```{r,echo=F}\n#| fig-width: 12\n#| fig-height: 7\n#| fig-retina: 2\n#| out-width: \"100%\"\nm_level0 <- models$m_level0\nlibrary(performance)\n\ncheck_model(m_level0)\n\nr2(m_level0)\n```\n\nCome possiamo vedere dal posterior predictive check il modello **riproduce bene la distribuzione** di `tPTEF_perc_tE` quindi la scelta di un GLM con family Gamma sembra essere stata corretta. Probabilmente un LMM (si potrebbe fare anche una prova) non sarebbe riuscito a predirre cosi bene i valori, e avrebbe predetto valori negativi dell' indice di respirazione che però è solo positivo. Inoltre, la diagnostica di uniformità dei residui simulati mostra un’aderenza soddisfacente alla diagonale attesa, supportando l’adeguatezza della specificazione del modello.\n\nPossiamo quindi guardare i coefficienti:\n\n```{r,echo=F}\n\nsummary(m_level0)\n```\n\nIl modello stima:\n\nlog(E\\[Y\\])=β0​+β1​Time+β2​BPD+β3​hsPDA+β4​GA+⋯+β9​(BPD×hsPDA)\n\ndove Y=`tPTEF_perc_tE`.\n\nQuindi: i coefficienti sono su scala logaritmica. Per interpretarli in termini di variazione percentuale:\n\n-   Se fai `exp(β)`, ottieni un **moltiplicatore** della media attesa di Y\n\nInterpretazione pratica:\n\n-   `exp(β) = 1.05` ⇒ circa **+5%** nell’outcome atteso per +1 unità del predittore.\n\n-   `exp(β) = 0.80` ⇒ circa **−20%** nell’outcome atteso.\n\nVediamo coefficiente ***Time***: Per ogni mese in più di età, il tPTEF%tE diminuisce in media dello 0.32%, mantenendo costanti BPD, esposizione a hsPDA, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Tuttavia, questo effetto non è statisticamente significativo (p = 0.317), quindi non abbiamo evidenza sufficiente per affermare che ci sia una variazione sistematica nel tempo della funzionalità respiratoria.\n\ncoefficiente **BPD:** I neonati con broncodisplasia (BPD) presentano in media un tPTEF%tE inferiore dell'11.4% rispetto ai neonati senza BPD, **in assenza di esposizione a hsPDA** (hsPDA = 0 giorni), mantenendo costanti età corretta, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Tuttavia, questa differenza non raggiunge la significatività statistica (p = 0.162).\n\nNei neonati senza BPD, ogni giorno aggiuntivo di esposizione a **hsPDA** è associato a una riduzione media dello 0.79% nel tPTEF%tE, mantenendo costanti età corretta, BPD, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Anche questo effetto non è statisticamente significativo (p = 0.598).\n\n**Per l'interazione BPD × hsPDA:** L'effetto dell'esposizione a hsPDA non differisce in modo statisticamente significativo tra neonati con e senza BPD (p = 0.607). Nei neonati con BPD, ogni giorno aggiuntivo di hsPDA è associato a un cambiamento trascurabile (+0.065%) rispetto all'effetto osservato nei neonati senza BPD.\n\nCoefficienti statisticamente significativi:\n\n**1. Età gestazionale (GA):**\n\nPer ogni settimana in più di età gestazionale alla nascita, il tPTEF%tE aumenta in media del **4,6%** , mantenendo costanti età corretta, BPD, esposizione a hsPDA, sesso, sepsi tardiva e ipertensione polmonare. Questo effetto è statisticamente significativo.\n\n**2. Sesso femminile (sex2):**\n\nI neonati di sesso femminile presentano in media un tPTEF%tE superiore del **16,4%** rispetto ai maschi, mantenendo costanti età corretta, BPD, esposizione a hsPDA, età gestazionale, sepsi tardiva e ipertensione polmonare. Questo effetto è statisticamente significativo (p = 0,026).\n\n**3. Ipertensione polmonare (PH1):**\n\nLa presenza di ipertensione polmonare è associata a una riduzione media del **19,9%** nel tPTEF%tE, mantenendo costanti età corretta, BPD, esposizione a hsPDA, età gestazionale, sesso e sepsi tardiva. Questo effetto è statisticamente significativo (p = 0,004).\n\n## **Modello Traiettorie**\n\nAdesso stimiamo il modello con interazione Time per capire meglio le traiettorie del tempo. In particolare rispondiamo alla domanda:\n\nLe associazioni di BPD e hsPDA con tPTEF%tE cambiano con l’età corretta? Cioè le traiettorie nel tempo differiscono tra gruppi?\n\n```{r, eval=F}\n\nm_traj <- glmmTMB(\n  tPTEF_perc_tE ~ Time * BPD * hsPDA + GA + sex + LOS + PH +\n    (1 | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod)\n\n\n```\n\n```{r,echo=F}\nm_traj <- models$m_traj\n```\n\nDiagnostiche:\n\n```{r}\n#| fig-width: 12\n#| fig-height: 7\n#| fig-retina: 2\n#| out-width: \"100%\"\ncheck_model(m_traj)\n\nr2(m_traj)\n```\n\nGuardiamo i coefficienti:\n\n```{r}\nsummary(m_traj)\n```\n\nQuesto modello include le interazioni con `Time` per verificare se l’associazione di BPD e/o hsPDA con tPTEF%tE **cambia in funzione dell’età corretta**. In particolare:\n\n-   `Time:BPD1` testa se la differenza BPD vs non-BPD varia con l’età (traiettorie non parallele tra BPD e non-BPD).`Time:BPD1` = 0.00488, p = 0.562. Interpretazione (scala log, quindi moltiplicativa): `exp(0.00488) ≈ 1.0049` → **+0.49% per mese.**\n\n    -   Significato: la differenza tra BPD e non-BPD **tenderebbe** ad attenuarsi/aumentare di circa mezzo punto percentuale per mese (a hsPDA=0), **ma** l’evidenza è debole (p=0.56). Non emerge evidenza che l’effetto della BPD vari con l’età corretta; le traiettorie BPD vs non-BPD risultano compatibili con andamenti paralleli.\n\n-   `Time:hsPDA` testa se l’effetto di hsPDA varia con l’età nei non-BPD. exp(−0.000337) ≈ 0.99966 → −0.034% quindi **−0.034% per mese per ogni giorno di hsPDA.** Significato: nei non-BPD, l’effetto di hsPDA **non** sembra cambiare al crescere dell’età (praticamente zero; p=0.80). Non emerge evidenza che l’associazione hsPDA→tPTEF%tE nei non-BPD sia diversa a età più basse vs più alte.\n\n-   `Time:BPD1:hsPDA` testa se la modificazione dell’effetto di hsPDA da parte della BPD **dipende dall’età** (cioè se l’eventuale interazione BPD×hsPDA è diversa a età più basse vs più alte). L' interazione tripla `Time×BPD×hsPDA` non è significativo (p=0.589), indicando che non emerge evidenza che la modificazione dell’effetto di hsPDA da parte della BPD cambi con l’età corretta. In altre parole, l’eventuale differenza nell’effetto di hsPDA tra BPD e non-BPD appare sostanzialmente costante lungo il follow-up.\n\nVerifichiamo quale tra i due modelli è migliore tra m_traj che ha l interazione con Time ed il modello principale m_level0.\n\nFacciamo il confronto dei due modelli tramite Likelihood Ratio Test (LRT):\n\n```{r}\n\nanova(m_level0, m_traj)\n```\n\n**AIC** (*Akaike Information Criterion*) e **BIC** (*Bayesian Information Criterion*) bilanciano la bontà del fit con una penalità per la complessità del modello (AIC e BIC più bassi = modello migliore).\n\nAIC: 1230.8 vs 1235.3 → favorisce m_level0 quindi il modello senza interazione con Time.\n\nBIC: 1266.8 vs 1281.1 → favorisce m_level0 (differenza di \\~14 punti, sostanziale)\n\nLRT: χ² = 1.52, df = 3, p = 0.68 → l'interazione tripla con il tempo non aggiunge nulla\n\nIl modello con interazioni con Time (`m_traj`) non migliora il fit rispetto al modello parsimonioso (`m_level0`): AIC e BIC risultano maggiori per `m_traj`, e il confronto tra modelli nidificati tramite LRT non è significativo (p = 0.68). Pertanto, per l’interpretazione principale riportiamo `m_level0`, che assume effetti costanti nel tempo e risulta supportato dai dati.\n\n### Analisi sensitività\n\nFittiamo il modello principale m_level0 togliendo GA e mettendo BW ovvero Peso Nascita:\n\n```{r, eval=F}\n\nm_sens_BW <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD * hsPDA + PN + sex + LOS + PH + (1 | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n```\n\n```{r, echo=F}\nm_sens_BW <- models$m_sens_BW\nsummary(m_sens_BW)\n```\n\nPer verificare la robustezza dei risultati rispetto all’aggiustamento per maturità alla nascita, abbiamo rifittato il modello principale sostituendo GA con il peso alla nascita (PN/BW). Le stime per BPD, hsPDA e la loro interazione rimangono coerenti (assenza di evidenza statistica), così come l’assenza di un trend temporale. L’associazione negativa con PH risulta stabile. Nel complesso, le conclusioni principali non dipendono dalla scelta GA vs BW come covariata di aggiustamento.\n\n<a href=\"outcome_secondari.html\" class=\"btn btn-primary\">Pagina successiva →</a>\n","srcMarkdownNoYaml":"\n\n## Data Cleaning\n\n```{r,echo=F}\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(tibble)\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(glmmTMB) \nlibrary(here)\nlibrary(performance)\n\ndf_or<-read_excel(\"DATI/DATABASE Lorenzo.xlsx\")\n\ndf_raw <- read_excel(\"DATI/DF_Lore.xlsx\")\nmodels_dir <- \"C:/Users/39348/Desktop/BPD/data/derived/models\"\nmodels <- readRDS(file.path(models_dir, \"all_models.rds\"))\n\n\n\n\n```\n\nDurante l'ispezione del dataset originale, ho notato che alcuni soggetti presentavano lo stesso ID (\"TRAKCARE\"), probabilmente un codice predefinito del software utilizzato per la raccolta dati. Per garantire l'univocità degli identificativi, ho assegnato a questi soggetti un nuovo codice nel formato \"LA\" seguito da un numero progressivo.\n\nVerifichiamo che ora ogni soggetto abbia un ID univoco:\n\n```{r}\ncheck_ID<-df_raw %>% count(df_raw$ID)\nsummary(check_ID)\n```\n\nIl controllo conferma che tutti gli ID sono ora univoci (ogni soggetto compare una sola volta).\n\nI nomi delle colonne nel dataset originale contenevano parentesi e caratteri speciali (ad esempio spazi, simboli come `%`, `/`), che possono creare problemi nella manipolazione dei dati in R. Ho quindi rinominato le colonne rimuovendo questi caratteri.\n\nInoltre, il dataset si presenta in formato *wide* (una riga per soggetto, con colonne separate per ogni timepoint). Per l'analisi longitudinale è necessario convertirlo in formato *long* (una riga per ogni osservazione, con una colonna che identifica il timepoint).\n\n```{r,echo=F,results=\"hide\"}\nclass(df_raw$Time_1)\nclass(df_raw$Time_2)\ndf_raw$Time_2<-as.numeric(df_raw$Time_2)\n\ndf_long <- df_raw %>%\n  pivot_longer(\n    cols = matches(\"_(\\\\d+)$\"),   # tutte le colonne che finiscono con _numero\n    names_to = c(\".value\", \"timepoint\"),\n    names_pattern = \"^(.*)_(\\\\d+)$\"\n  ) %>%\n  mutate(timepoint = as.integer(timepoint))\n\n\n#check:\ngrep(\"tPTE\", names(df_long), value = TRUE)\n\n\n```\n\nControlliamo adesso il numero di osservazioni che abbiamo per ciascun timepoint.\n\n```{r}\ndf_long %>%\n  filter(!is.na(tPTEF_perc_tE)) %>%\n  distinct(ID, timepoint) %>%\n  count(timepoint)\n```\n\nVediamo che abbiamo 99 osservazioni dell'outocome di interesse **tPTEF_perc_tE** al primo timepoint; poi 64 al secondo e 32 al terzo.\n\nPer una visualizzazione più immediata:\n\n```{r,echo=F}\ndf_long %>%\n  filter(!is.na(tPTEF_perc_tE)) %>%\n  count(timepoint) %>%\n  ggplot(aes(x = factor(timepoint), y = n)) +\n  geom_col(fill = \"grey80\", color = \"black\") +\n  labs(x = \"Timepoint\", y = \"Number of observations  tPTEF%tE\") +\n  theme_classic(base_size = 14)\n```\n\nVediamo come si distribuisce l'outcome di interesse primario: tPTEF/Te % che nel nostro dataset è stato rinominato in tPTEF_perc_tE.\n\n```{r,echo=F}\ndf_use <- df_long %>% filter(!is.na(tPTEF_perc_tE))\n\nx_min <- min(df_use$tPTEF_perc_tE, na.rm = TRUE)\nx_max <- max(df_use$tPTEF_perc_tE, na.rm = TRUE)\n\n# -----------------------\n# 1) HISTOGRAM (count)\n# -----------------------\np_hist_dens <- ggplot(df_use, aes(x = tPTEF_perc_tE)) +\n  geom_histogram(\n    aes(y = after_stat(density)),\n    bins = 25,\n    fill = \"grey85\",\n    color = \"black\",\n    linewidth = 0.35\n  ) +\n  geom_density(\n    color = \"red3\",   # se la vuoi rossa\n    linewidth = 1,\n    trim = TRUE,\n    cut = 0\n  ) +\n  coord_cartesian(xlim = c(x_min, x_max)) +\n  labs(\n    title = \"Distribution of tPTEF%tE\",\n    x = \"tPTEF%tE\",\n    y = \"Density\"\n  ) +\n  theme_classic(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\"),\n    axis.line = element_line(color = \"black\"),\n    axis.ticks = element_line(color = \"black\")\n  )\n\np_hist_dens\n\n```\n\nDal grafico si vede che tPTEF%tE ha una distribuzione **asimmetrica positiva** (coda/skewed a destra). Questa forma è coerente con la scelta di fittare **un GLMM** (Generalized Linear Mixed Model) con family **Gamma** e **link log**, che gestisce bene variabili continue, positive e con asimmetria positiva.\n\n## Modello ad effetti misti GLMM\n\nStimiamo un *mixed model* per rispondere alla domanda di ricerca principale e fare valutazione della funzione respiratoria nei neonati con e senza broncodisplasia.\n\nDataset su cui stimeremo il modello:\n\n```{r}\ndf_mod <- df_long %>%\n  filter(!is.na(Time), !is.na(tPTEF_perc_tE),!is.na(PH)) %>%\n  mutate(\n    ID = factor(ID),\n    \n    BPD = factor(BPD_Jensen, levels = c(0,1)),#0=No;1=YES\n    sex = factor(sex1M2F, levels = c(1,2)),#1=M;2=F\n    \n    LOS = factor(LOS),\n    PH  = factor(PH),\n    GA=  as.numeric(EG),\n    hsPDA = as.numeric(HSPDAgg)\n    \n    )\n\n```\n\nIdealmente, il modello \"migliore\" avrebbe slope ed intercetta random (1 + Time \\| ID).\n\nNel termine `(1 + Time | ID)`:\n\n-   (**1 \\| ID)** = ogni soggetto ha una propria intercetta: consente livelli medi diversi di tPTEF%tE tra bambini.\n\n-   **(Time \\| ID)** = **quanto cambia nel tempo ogni partecipante**, cioè la sua “traiettoria”. E' ragionevole supporre che ogni neonato abbia una diversa pendenza.\n\n    Questa specifica è utile se i dati contengono informazione sufficiente per stimare variazione inter-individuale nelle traiettorie.\n\n```{r, eval=F}\nm_level <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD*HSPDAgg + GA + sex + LOS + PH +\n    (1 + Time | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n\n```\n\n```{r,echo=F}\nm_level <- models$m_level\nsummary(m_level)\n```\n\nFacendo la diagnostica della parte random si vede che la varianza della slope random di `Time` è praticamente nulla (≈ 0.000014) e la correlazione intercetta–slope è stimata a -1.00. Questo pattern indica che i dati **non supportano** una stima affidabile della slope random (modello “troppo complesso” rispetto all’informazione disponibile), e quindi la specifica più appropriata per l’analisi principale è il **random intercept** `(1 | ID)`.I l modello cheha una parte “random” troppo complessa rispetto all’informazione nei dati, quindi alcuni parametri dei random effects finiscono “sul bordo” (≈ 0) o diventano perfettamente collineari......\n\nRifittiamo quindi il modello con la sola intercetta random **(1 \\| ID).**\n\n```{r, eval=F}\nm_level0 <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD*hsPDA + GA + sex + LOS + PH +\n    (1 |  ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n\n```\n\nCome prima cosa andiamo a vedere i residui e gli assunti:\n\n```{r,echo=F}\n#| fig-width: 12\n#| fig-height: 7\n#| fig-retina: 2\n#| out-width: \"100%\"\nm_level0 <- models$m_level0\nlibrary(performance)\n\ncheck_model(m_level0)\n\nr2(m_level0)\n```\n\nCome possiamo vedere dal posterior predictive check il modello **riproduce bene la distribuzione** di `tPTEF_perc_tE` quindi la scelta di un GLM con family Gamma sembra essere stata corretta. Probabilmente un LMM (si potrebbe fare anche una prova) non sarebbe riuscito a predirre cosi bene i valori, e avrebbe predetto valori negativi dell' indice di respirazione che però è solo positivo. Inoltre, la diagnostica di uniformità dei residui simulati mostra un’aderenza soddisfacente alla diagonale attesa, supportando l’adeguatezza della specificazione del modello.\n\nPossiamo quindi guardare i coefficienti:\n\n```{r,echo=F}\n\nsummary(m_level0)\n```\n\nIl modello stima:\n\nlog(E\\[Y\\])=β0​+β1​Time+β2​BPD+β3​hsPDA+β4​GA+⋯+β9​(BPD×hsPDA)\n\ndove Y=`tPTEF_perc_tE`.\n\nQuindi: i coefficienti sono su scala logaritmica. Per interpretarli in termini di variazione percentuale:\n\n-   Se fai `exp(β)`, ottieni un **moltiplicatore** della media attesa di Y\n\nInterpretazione pratica:\n\n-   `exp(β) = 1.05` ⇒ circa **+5%** nell’outcome atteso per +1 unità del predittore.\n\n-   `exp(β) = 0.80` ⇒ circa **−20%** nell’outcome atteso.\n\nVediamo coefficiente ***Time***: Per ogni mese in più di età, il tPTEF%tE diminuisce in media dello 0.32%, mantenendo costanti BPD, esposizione a hsPDA, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Tuttavia, questo effetto non è statisticamente significativo (p = 0.317), quindi non abbiamo evidenza sufficiente per affermare che ci sia una variazione sistematica nel tempo della funzionalità respiratoria.\n\ncoefficiente **BPD:** I neonati con broncodisplasia (BPD) presentano in media un tPTEF%tE inferiore dell'11.4% rispetto ai neonati senza BPD, **in assenza di esposizione a hsPDA** (hsPDA = 0 giorni), mantenendo costanti età corretta, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Tuttavia, questa differenza non raggiunge la significatività statistica (p = 0.162).\n\nNei neonati senza BPD, ogni giorno aggiuntivo di esposizione a **hsPDA** è associato a una riduzione media dello 0.79% nel tPTEF%tE, mantenendo costanti età corretta, BPD, età gestazionale, sesso, sepsi tardiva e ipertensione polmonare. Anche questo effetto non è statisticamente significativo (p = 0.598).\n\n**Per l'interazione BPD × hsPDA:** L'effetto dell'esposizione a hsPDA non differisce in modo statisticamente significativo tra neonati con e senza BPD (p = 0.607). Nei neonati con BPD, ogni giorno aggiuntivo di hsPDA è associato a un cambiamento trascurabile (+0.065%) rispetto all'effetto osservato nei neonati senza BPD.\n\nCoefficienti statisticamente significativi:\n\n**1. Età gestazionale (GA):**\n\nPer ogni settimana in più di età gestazionale alla nascita, il tPTEF%tE aumenta in media del **4,6%** , mantenendo costanti età corretta, BPD, esposizione a hsPDA, sesso, sepsi tardiva e ipertensione polmonare. Questo effetto è statisticamente significativo.\n\n**2. Sesso femminile (sex2):**\n\nI neonati di sesso femminile presentano in media un tPTEF%tE superiore del **16,4%** rispetto ai maschi, mantenendo costanti età corretta, BPD, esposizione a hsPDA, età gestazionale, sepsi tardiva e ipertensione polmonare. Questo effetto è statisticamente significativo (p = 0,026).\n\n**3. Ipertensione polmonare (PH1):**\n\nLa presenza di ipertensione polmonare è associata a una riduzione media del **19,9%** nel tPTEF%tE, mantenendo costanti età corretta, BPD, esposizione a hsPDA, età gestazionale, sesso e sepsi tardiva. Questo effetto è statisticamente significativo (p = 0,004).\n\n## **Modello Traiettorie**\n\nAdesso stimiamo il modello con interazione Time per capire meglio le traiettorie del tempo. In particolare rispondiamo alla domanda:\n\nLe associazioni di BPD e hsPDA con tPTEF%tE cambiano con l’età corretta? Cioè le traiettorie nel tempo differiscono tra gruppi?\n\n```{r, eval=F}\n\nm_traj <- glmmTMB(\n  tPTEF_perc_tE ~ Time * BPD * hsPDA + GA + sex + LOS + PH +\n    (1 | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod)\n\n\n```\n\n```{r,echo=F}\nm_traj <- models$m_traj\n```\n\nDiagnostiche:\n\n```{r}\n#| fig-width: 12\n#| fig-height: 7\n#| fig-retina: 2\n#| out-width: \"100%\"\ncheck_model(m_traj)\n\nr2(m_traj)\n```\n\nGuardiamo i coefficienti:\n\n```{r}\nsummary(m_traj)\n```\n\nQuesto modello include le interazioni con `Time` per verificare se l’associazione di BPD e/o hsPDA con tPTEF%tE **cambia in funzione dell’età corretta**. In particolare:\n\n-   `Time:BPD1` testa se la differenza BPD vs non-BPD varia con l’età (traiettorie non parallele tra BPD e non-BPD).`Time:BPD1` = 0.00488, p = 0.562. Interpretazione (scala log, quindi moltiplicativa): `exp(0.00488) ≈ 1.0049` → **+0.49% per mese.**\n\n    -   Significato: la differenza tra BPD e non-BPD **tenderebbe** ad attenuarsi/aumentare di circa mezzo punto percentuale per mese (a hsPDA=0), **ma** l’evidenza è debole (p=0.56). Non emerge evidenza che l’effetto della BPD vari con l’età corretta; le traiettorie BPD vs non-BPD risultano compatibili con andamenti paralleli.\n\n-   `Time:hsPDA` testa se l’effetto di hsPDA varia con l’età nei non-BPD. exp(−0.000337) ≈ 0.99966 → −0.034% quindi **−0.034% per mese per ogni giorno di hsPDA.** Significato: nei non-BPD, l’effetto di hsPDA **non** sembra cambiare al crescere dell’età (praticamente zero; p=0.80). Non emerge evidenza che l’associazione hsPDA→tPTEF%tE nei non-BPD sia diversa a età più basse vs più alte.\n\n-   `Time:BPD1:hsPDA` testa se la modificazione dell’effetto di hsPDA da parte della BPD **dipende dall’età** (cioè se l’eventuale interazione BPD×hsPDA è diversa a età più basse vs più alte). L' interazione tripla `Time×BPD×hsPDA` non è significativo (p=0.589), indicando che non emerge evidenza che la modificazione dell’effetto di hsPDA da parte della BPD cambi con l’età corretta. In altre parole, l’eventuale differenza nell’effetto di hsPDA tra BPD e non-BPD appare sostanzialmente costante lungo il follow-up.\n\nVerifichiamo quale tra i due modelli è migliore tra m_traj che ha l interazione con Time ed il modello principale m_level0.\n\nFacciamo il confronto dei due modelli tramite Likelihood Ratio Test (LRT):\n\n```{r}\n\nanova(m_level0, m_traj)\n```\n\n**AIC** (*Akaike Information Criterion*) e **BIC** (*Bayesian Information Criterion*) bilanciano la bontà del fit con una penalità per la complessità del modello (AIC e BIC più bassi = modello migliore).\n\nAIC: 1230.8 vs 1235.3 → favorisce m_level0 quindi il modello senza interazione con Time.\n\nBIC: 1266.8 vs 1281.1 → favorisce m_level0 (differenza di \\~14 punti, sostanziale)\n\nLRT: χ² = 1.52, df = 3, p = 0.68 → l'interazione tripla con il tempo non aggiunge nulla\n\nIl modello con interazioni con Time (`m_traj`) non migliora il fit rispetto al modello parsimonioso (`m_level0`): AIC e BIC risultano maggiori per `m_traj`, e il confronto tra modelli nidificati tramite LRT non è significativo (p = 0.68). Pertanto, per l’interpretazione principale riportiamo `m_level0`, che assume effetti costanti nel tempo e risulta supportato dai dati.\n\n### Analisi sensitività\n\nFittiamo il modello principale m_level0 togliendo GA e mettendo BW ovvero Peso Nascita:\n\n```{r, eval=F}\n\nm_sens_BW <- glmmTMB(\n  tPTEF_perc_tE ~ Time + BPD * hsPDA + PN + sex + LOS + PH + (1 | ID),\n  family = Gamma(link = \"log\"),\n  data = df_mod\n)\n```\n\n```{r, echo=F}\nm_sens_BW <- models$m_sens_BW\nsummary(m_sens_BW)\n```\n\nPer verificare la robustezza dei risultati rispetto all’aggiustamento per maturità alla nascita, abbiamo rifittato il modello principale sostituendo GA con il peso alla nascita (PN/BW). Le stime per BPD, hsPDA e la loro interazione rimangono coerenti (assenza di evidenza statistica), così come l’assenza di un trend temporale. L’associazione negativa con PH risulta stabile. Nel complesso, le conclusioni principali non dipendono dalla scelta GA vs BW come covariata di aggiustamento.\n\n<a href=\"outcome_secondari.html\" class=\"btn btn-primary\">Pagina successiva →</a>\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"number-sections":false,"self-contained":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","theme":"flatly","title":"Analisi Statistiche BPD","author":"Lorenzo Atzeni","editor":"visual"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}